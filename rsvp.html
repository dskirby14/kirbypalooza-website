<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Kirbypalooza | RSVP HERE</title>

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css"> 
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
  
</head>

<body>
  <header class="container">
    <nav>
      <ul>
        <li><strong>Kirbypalooza</strong></li>
      </ul>
      <ul>
        <li><a href="index.html" role="button">Home</a></li>
        <li><a href="rsvp.html" role="button">RSVP HERE!</a></li>
        <li><a href="gallery.html" role="button">Gallery</a></li>
        <li><a href="Hall of Fame.html" role="button">Hall of Fame</a></li>
        <li><a href="Where is Steve.html" role="button">Where is Steve?</a></li>
        <li><a href="about.html" role="button">About</a></li>
      </ul>
    </nav>
  </header>

  <main class="container" style="text-align: center;">
      <h2>RSVP for Kirbypalooza!</h2>
  
      <form id="rsvp-form">
        <!--<div>
          <label for="rsvp">Number of guests?</label>
          <input type="number" id="rsvp" name="rsvp" value="1" min="1">
        </div>-->
        
        <div class="grid">
          <div>
            <label for="name">Name</label>
            <input type="text" id="name" name="name" placeholder="Your Name" required>
          </div>

          <div>
            <label for="phone">Phone Number</label>
            <input type="tel" id="phone" name="phone"  class="phone-format" maxlength="14" placeholder="For text reminders" oninput="this.value = this.value.replace(/[^0-9]/g, '')" required>
           </div>
        </div>
        
        <div class="grid">          
          <div>
            <label for="size">Shirt Size</label>
            <select name="size" required>
              <option value="" disabled selected>For team shirts!</option>
              <option value="S">S</option><option value="M">M</option><option value="L">L</option><option value="XL">XL</option><option value="XXL">XXL</option><option value="Child">Child</option>
            </select>
          </div>

          <div>
            <label for="song">Song Requests</label>
            <input type="text" id="song" name="song" placeholder="Bangers Only">
          </div>
        </div>
                  
        <div class="grid">          
          <div>
            <label for="song">Childcare Needed?</label>
            <select name="childcare" required>
              <option value="" disabled selected>We'll have babysitters</option>
              <option value="No">No</option>
              <option value="Yes">Yes</option>
            </select>
          </div>

          <div>
            <label for="guest-count">Number of Guests</label>
            <input type="number" id="guest-count" name="guests" value="1" min="1" max="10" required>
          </div>
        </div>

        <div id="extra-guests-container"></div>
               
        <button type="submit" id="submit-btn">Send RSVP</button>

      </form>
  
    <div id="form-message" style="display:none; padding: 1rem; background: #d4edda; color: #155724; border-radius: 8px;">
      Thanks! Your RSVP has been sent. ðŸŒŸ
    </div>


</main>

  <footer class="container" style="text-align: right;">
    <small>Â© 2025 Kirbypalooza</small>
  </footer>

<script>
  const scriptURL = 'https://script.google.com/macros/s/AKfycbw0YXxqtUAQHLpQhPBmrnyhF742UcZqQRbyderAg-JWcZvaaSC79ftYaUmDKH5xEDKb/exec';
  const form = document.getElementById('rsvp-form');
  const guestInput = document.getElementById('guest-count');
  const extraContainer = document.getElementById('extra-guests-container');
  const msg = document.getElementById('form-message');
  const btn = document.getElementById('submit-btn');

  // --- 1. THE FORMATTING LOGIC ---
  function formatPhoneNumber(value) {
    if (!value) return value;
    const phoneNumber = value.replace(/[^\d]/g, '');
    const phoneNumberLength = phoneNumber.length;
    if (phoneNumberLength < 4) return phoneNumber;
    if (phoneNumberLength < 7) {
      return `(${phoneNumber.slice(0, 3)}) ${phoneNumber.slice(3)}`;
    }
    return `(${phoneNumber.slice(0, 3)}) ${phoneNumber.slice(3, 6)}-${phoneNumber.slice(6, 10)}`;
  }

  // Apply formatting to the Primary Guest phone field
  document.querySelector('[name="phone"]').addEventListener('input', (e) => {
    e.target.value = formatPhoneNumber(e.target.value);
  });

  // --- 2. THE GUEST GENERATOR (The "Loop") ---
  guestInput.addEventListener('input', () => {
    const count = parseInt(guestInput.value);
    extraContainer.innerHTML = ''; 

    for (let i = 2; i <= count; i++) {
      const guestDiv = document.createElement('div');
      guestDiv.innerHTML = `
        <hr>
        <p><strong>Guest ${i} Details</strong></p>
        <div class="grid">
            <div>
              <label>Name</label>
              <input type="text" name="guest_${i}_name" placeholder="Guest Name" required>
            </div>
            <div>
              <label>Phone</label>
              <input type="text" name="guest_${i}_phone" placeholder="So we can remind you to carpool" maxlength="14">
            </div>
        </div>
        <div class="grid">
          <div>
            <label>T-Shirt</label>
            <select name="guest_${i}_size" required>
              <option value="" disabled selected>For team shirts!</option>
              <option value="S">S</option>
              <option value="M" >M</option>
              <option value="L">L</option>
              <option value="XL">XL</option>
              <option value="XXL">XXL</option>
              <option value="Child">Child</option>
            </select>
          </div>
          <div>
            <label for="song">Song Requests</label>
            <input type="text" id="song" name="song" placeholder="Bangers Only">
          </div>
        </div>
      `;
      extraContainer.appendChild(guestDiv);

      // THIS IS THE FIX: We tell the computer to watch the NEW phone box we just made
      const newPhoneInput = guestDiv.querySelector(`[name="guest_${i}_phone"]`);
      newPhoneInput.addEventListener('input', (e) => {
        e.target.value = formatPhoneNumber(e.target.value);
      });
    }
  });

  // --- 3. THE SUBMIT LOGIC ---
  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    btn.disabled = true;
    btn.innerText = "Saving RSVPs...";

    const songRequest = form.querySelector('[name="song"]').value;
    const childcare = form.querySelector('[name="childcare"]').value;
    const totalGuests = parseInt(guestInput.value);

    let guestsToSend = [];

    // Guest 1
    guestsToSend.push({
      name: form.querySelector('[name="name"]').value,
      phone: form.querySelector('[name="phone"]').value,
      size: form.querySelector('[name="size"]').value,
      song: songRequest,
      childcare: childcare
    });

    // Extra Guests
    for (let i = 2; i <= totalGuests; i++) {
      guestsToSend.push({
        name: form.querySelector(`[name="guest_${i}_name"]`).value,
        phone: form.querySelector(`[name="guest_${i}_phone"]`).value,
        size: form.querySelector(`[name="guest_${i}_size"]`).value,
        song: songRequest,
        childcare: childcare
      });
    }

    try {
      for (const guest of guestsToSend) {
        const formData = new FormData();
        formData.append('name', guest.name);
        formData.append('phone', guest.phone);
        formData.append('size', guest.size);
        formData.append('song', guest.song);
        formData.append('childcare', guest.childcare);

        await fetch(scriptURL, { method: 'POST', mode: 'no-cors', body: formData });
      }
      form.style.display = 'none';
      msg.style.display = 'block';
      msg.innerText = "All RSVPs saved! ðŸŒŸ";
    } catch (error) {
      btn.disabled = false;
      btn.innerText = "Try Again";
    }
  });
</script>
</body>
</html>
